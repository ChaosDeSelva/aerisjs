<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      #map-canvas {
        width: 600px;
        height: 400px;
      }
    </style>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxTEbJsXwGRW4zDj8fpVsenDMMQGhZhUU&sensor=false">
    </script>
    <script type="text/javascript"
      src="http://openlayers.org/api/OpenLayers.js">
    </script>
    <script data-main="../../lib/config" src="../../externals/require.js"></script>
    <script type="text/javascript">
      function LayerRepository(aeris) {
        this.aeris = aeris;
        this.layers = {};
      }
      LayerRepository.prototype.getLayer = function(layer) {
        var layer_ = this.layers[layer];
        if (!layer_) {
          layer_ = this.layers[layer] = new this.aeris.maps.layers[layer]();
        }
        return layer_;
      };

      function initialize() {
        var req = require.config({
          config: {
            aeris: {
              apiId: 'ezHWL0MiLsxwlN2ik8U4c',
              apiSecret: 'uCDMeSj91lBfIKCmeQkpeZjsAwUUQJHuKesCvqTm'
            }
          }
        });
        req(["aeris/maps/openlayers"], function(aeris) {

          var layerRepo = new LayerRepository(aeris);

          var map = new aeris.maps.openlayers.Map("map-canvas", {
            baseLayer: layerRepo.getLayer('OSM'),
            center: [44.98, -93.2636],
            zoom: 4
          });

          // Base layer

          var $baseLayer = $("#base-layer");
          $baseLayer.change(function() {
            var layer = layerRepo.getLayer($baseLayer.val());
            map.layers.setBaseLayer(layer);
          });

          // Radar

          var radar = new aeris.maps.layers.AerisRadar();
          radar.setMap(map);
          radar.autoUpdate();

          var $radarVisibility = $("#radar-visibility");
          $radarVisibility.change(function() {
            radar[$radarVisibility.val()]();
          });

          var $radarOpacity = $("#radar-opacity");
          $radarOpacity.change(function() {
            radar.setOpacity($radarOpacity.val());
          });

          // Animate

          var radarAnim = radar.animate();

          var $animStart = $("#anim-start");
          $animStart.click(function() {
            radarAnim.start();
            return false;
          });

          var $animPause = $("#anim-pause");
          $animPause.click(function() {
            radarAnim.pause();
            return false;
          });

          var $animStop = $("#anim-stop");
          $animStop.click(function() {
            radarAnim.stop();
            return false;
          });

          var $animPrev = $("#anim-prev");
          $animPrev.click(function() {
            radarAnim.previous();
            return false;
          });

          var $animNext = $("#anim-next");
          $animNext.click(function() {
            radarAnim.next();
            return false;
          });
        });
      }
    </script>
  </head>
  <body>
    <div id="map-canvas"></div>

    <h3>Base Layer</h3>
    <div>
      <select id="base-layer">
        <option value="OSM" selected="selected">OpenStreetMap</option>
        <option value="GoogleRoadMap">Google Street Map</option>
        <option value="GoogleSatellite">Google Satellite</option>
        <option value="GoogleTerrain">Google Terrain</option>
        <option value="GoogleHybrid">Google Hybrid</option>
      </select>
    </div>

    <h3>Radar</h3>
    <div>
      <label for="radar-visibility">Visibility:</label>
      <select id="radar-visibility">
        <option value="show" selected="selected">Show</option>
        <option value="hide">Hide</option>
      </select>
    </div>
    <div>
      <label for="radar-opacity">Opacity:</label>
      <select id="radar-opacity">
        <option value="1" selected="selected">100%</option>
        <option value="0.9">90%</option>
        <option value="0.8">80%</option>
        <option value="0.7">70%</option>
        <option value="0.6">60%</option>
        <option value="0.5">50%</option>
        <option value="0.4">40%</option>
        <option value="0.3">30%</option>
        <option value="0.2">20%</option>
        <option value="0.1">10%</option>
        <option value="0">0%</option>
      </select>
    </div>

    <h3>Animation</h3>
    <div>
      <a href="#" id="anim-start">Start</a> &#160;|&#160;
      <a href="#" id="anim-pause">Pause</a> &#160;|&#160;
      <a href="#" id="anim-stop">Stop</a>
    </div>
    <div>
      <a href="#" id="anim-prev">Previous</a> &#160;|&#160;
      <a href="#" id="anim-next">Next</a>
    </div>
    <script type="text/javascript">
      initialize();
    </script>
  </body>
</html>

