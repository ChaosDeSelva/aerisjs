<!DOCTYPE html>
<html>
<head>
  <title>Aeris Interactive - Animation Sync Example</title>

  <link rel="stylesheet" href="../css/example.css"/>
  <link rel="shortcut icon" type="image/x-icon" href="../weather.ico"/>

  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=geometry"></script>
  <script type="text/javascript" src="../../build/packages/gmaps-plus.js"></script>
  <script type="text/javascript" src="../apikeys.js"></script>
</head>
<body>
<div id="map-canvas"></div>

<div id="loading">Loading animation layers... <br>
  <span id="progress"></span>% done.
</div>

<div class="prompt">
  <h1>Example: Animation Sync</h1>

  <h2>Aeris Interactive</h2>

  <p>
    In order to animate multiple tile layers, use an <code>aeris.maps.animations.AnimationSync</code> object. The <code>AnimationSync</code> keeps multiple animations on the same timeline.
  </p>
</div>

<div class="controls">
  <p>
    Time:
    <span id="currentTime"></span>
  </p>

  <div class="animationControls">
    <button id="prev"><img src="../images/prev.png"/></button>
    <button id="start"><img src="../images/play.png"/></button>
    <button id="next"><img src="../images/next.png"/></button>
    <button id="pause"><img src="../images/pause.png"/></button>
    <button id="stop"><img src="../images/stop.png"/></button>
  </div>
</div>

<script type="text/javascript">
  var map = new aeris.maps.Map('map-canvas', {
    zoom: 5,
    center: [40, -95]
  });
  var radar = new aeris.maps.layers.AerisRadar({
    apiId: apiKeys.aeris.id,
    apiSecret: apiKeys.aeris.secret
  });
  var satellite = new aeris.maps.layers.AerisSatellite({
    apiId: apiKeys.aeris.id,
    apiSecret: apiKeys.aeris.secret
  });

  // Create individual animation objects
  var radarAnimation = new aeris.maps.animations.AerisInteractiveTile(radar, {
    // Limit the number of layers to load
    limit: 20
  });
  var satelliteAnimation = new aeris.maps.animations.AerisInteractiveTile(satellite, {
    limit: 20
  });

  // Pass the animation objects to an AnimationSync
  // The AnimationSync uses the same interface as the
  // AerisInteractiveTile animation objects.
  var animationSync = new aeris.maps.animations.AnimationSync([radarAnimation, satelliteAnimation]);

  radar.setMap(map);
  satellite.setMap(map);

  $('#loading').show();


  // You can start the animation right away.
  // The animation may start out choppy, but as layers are
  // loaded, they will be added to the animation.
  //
  // Alternatively, you can wait for the 'load:complete' event
  // to fire.
  animationSync.start();


  // The animation object triggers
  // load:* events, to update listeners on loading progress.
  animationSync.on({
    'load:progress': function(progress) {
      $('#progress').text((progress * 100).toFixed(1));
    },

    'load:complete': function() {
      $('#loading').delay(500).hide();
    },

    // When the map bounds change,
    // tiles must be reloaded.
    // This fires a 'load:reset' event,
    // and then 'load:progress' events as the
    // tiles reload
    'load:reset': function() {
      $('#loading').show();
    },

    'load:error': function(err) {
      throw err;
    }
  });


  // A 'change:times' event is triggered
  // with a date object corresponding to the
  // current animation frame.
  animationSync.on('change:time', function(date) {
    var formattedTime = date.toTimeString().replace(/.*(\d{2}:\d{2})(:\d{2}).*/, "$1");
    $('#currentTime').text(formattedTime);
  });


  // Animation controls
  $('#start').click(function() {
    animationSync.start();
  });
  $('#stop').click(function() {
    animationSync.stop();
  });
  $('#pause').click(function() {
    animationSync.pause();
  });
  $('#prev').click(function() {
    animationSync.previous();
  });
  $('#next').click(function() {
    animationSync.next();
  });
</script>
</body>
</html>